<!DOCTYPE html>
<html>
<head>
    <title>근처 병원 리스트</title>
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBJrB7Ah5YJqx_2komtNmYESZmhTPd5x-U&callback=initMap&libraries=places"></script>

    <style>
        #map {
            height: 400px;
            width: 80%;
            margin-bottom: 20px;
        }

        #medicalList {
            list-style-type: none;
            padding: 0;
        }

        #medicalList li {
            margin-bottom: 5px;
            cursor: pointer;
            color: blue;
        }
        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }
    </style>
</head>
<body>
    <h1>근처 병원 리스트</h1>
    <div id="map"></div>
    <ul id="medicalList"></ul>
</body>
<script>
    var map; // 전역 변수로 지도 객체를 선언합니다.
    var infowindow; // 전역 변수로 정보 창 객체를 선언합니다.

    // Initialize the map
    function initMap() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                map = new google.maps.Map(document.getElementById('map'), {
                    center: userLocation,
                    zoom: 14 // Zoom level
                });

                infowindow = new google.maps.InfoWindow();

                searchMedicalCenter(userLocation);
            }, function () {
                handleLocationError(true, infowindow, map.getCenter());
            });
        } else {
            handleLocationError(false, infowindow, map.getCenter());
        }
    }

    function handleLocationError(browserHasGeolocation, infowindow, userLocation) {
        infowindow.setPosition(userLocation);
        infowindow.setContent(browserHasGeolocation ?
            'Error: The Geolocation service failed.' :
            'Error: Your browser doesn\'t support geolocation.');
        infowindow.open(map);
    }

    function searchMedicalCenter(location) {
        var request = {
            location: location,
            rankBy: google.maps.places.RankBy.DISTANCE, // Sort by distance
            keyword: '안과'
        };
        var service = new google.maps.places.PlacesService(map);
        service.nearbySearch(request, callback);
    }

    function callback(results, status) {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
            document.getElementById('medicalList').innerHTML = '';
            results.forEach(function (place) {
                createMarker(place);
                addListItem(place);
            });
        }
    }

    function createMarker(place) {
        var marker = new google.maps.Marker({
            map: map,
            position: place.geometry.location,
            title: place.name
        });

        marker.addListener('click', function () {
            infowindow.setContent('<div><strong>' + place.name + '</strong></div>');
            infowindow.open(map, marker);
        });
    }

    function addListItem(place) {
        var listItem = document.createElement('li');
        listItem.textContent = place.name;
        listItem.addEventListener('click', function () {
            map.setCenter(place.geometry.location);
            infowindow.setContent('<div><strong>' + place.name + '</strong></div>');
            infowindow.open(map);
        });
        document.getElementById('medicalList').appendChild(listItem);
    }
</script>
</html>
